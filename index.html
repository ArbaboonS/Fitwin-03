<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fitness Tracker App with STEPN-like Features</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/telegram-web-app/6.7.0/telegram-web-app.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css">
<style>
body {
font-family: Arial, sans-serif;
margin: 0;
padding: 0;
background-color: var(--tg-theme-bg-color, #ffffff);
color: var(--tg-theme-text-color, #000000);
}
.container {
max-width: 600px;
margin: 0 auto;
padding: 20px;
}
h1, h2, h3 {
text-align: center;
}
.button {
display: block;
width: 100%;
padding: 10px;
margin: 10px 0;
background-color: var(--tg-theme-button-color, #3390ec);
color: var(--tg-theme-button-text-color, #ffffff);
border: none;
border-radius: 5px;
font-size: 16px;
cursor: pointer;
}
.stats {
display: flex;
justify-content: space-around;
margin-bottom: 20px;
}
.stat-item {
text-align: center;
}
.progress-bar {
width: 100%;
background-color: #e0e0e0;
padding: 3px;
border-radius: 3px;
margin-bottom: 20px;
}
.progress-bar-fill {
display: block;
height: 22px;
background-color: #659cef;
border-radius: 3px;
transition: width 500ms ease-in-out;
}
.progress-bar-text {
color: white;
text-align: center;
line-height: 22px;
}
#map {
width: 100%;
height: 300px;
background-color: #f0f0f0;
margin-bottom: 20px;
}
.sneaker-types {
display: flex;
justify-content: space-around;
margin-bottom: 20px;
}
.sneaker-type {
text-align: center;
cursor: pointer;
padding: 10px;
border: 1px solid #ccc;
border-radius: 5px;
}
.sneaker-type.active {
background-color: #e0e0e0;
}
</style>
</head>
<body>
<div class="container">
<h1>Fitness Tracker App with STEPN-like Features</h1>

<div id="home" style="display: block;">
<h2>Home</h2>
<div class="stats">
<div class="stat-item">
<h3>GST</h3>
<p id="gst">0</p>
</div>
<div class="stat-item">
<h3>Energy</h3>
<p id="energy">10</p>
</div>
<div class="stat-item">
<h3>Level</h3>
<p id="level">0</p>
</div>
</div>
<div class="progress-bar">
<span class="progress-bar-fill" style="width:0%;">
<span class="progress-bar-text">0%</span>
</span>
</div>
<h3>Select Sneaker Type</h3>
<div class="sneaker-types">
<div class="sneaker-type" onclick="selectSneakerType('Walker')">Walker</div>
<div class="sneaker-type" onclick="selectSneakerType('Jogger')">Jogger</div>
<div class="sneaker-type" onclick="selectSneakerType('Runner')">Runner</div>
<div class="sneaker-type" onclick="selectSneakerType('Trainer')">Trainer</div>
</div>
<div id="map"></div>
<button class="button" onclick="startTracking()">Start Tracking</button>
<button class="button" onclick="stopTracking()">Stop Tracking</button>
<button class="button" onclick="showChallenges()">Challenges</button>
<button class="button" onclick="showRewards()">Rewards</button>
<button class="button" onclick="showInvite()">Invite Friends</button>
<button class="button" onclick="showStats()">Stats & Progress</button>
<button class="button" onclick="showLevelUp()">Level Up</button>
<button class="button" onclick="showShop()">Shop</button>
</div>

<div id="challenges" style="display: none;">
<h2>Challenges</h2>
<button class="button" onclick="joinChallenge('5km Walk')">5km Walk Challenge</button>
<button class="button" onclick="joinChallenge('10km Run')">10km Run Challenge</button>
<button class="button" onclick="joinChallenge('Burn 500 Calories')">Burn 500 Calories Challenge</button>
<button class="button" onclick="showHome()">Back to Home</button>
</div>

<div id="rewards" style="display: none;">
<h2>Rewards</h2>
<p>Your Score: <span id="rewardScore">0</span></p>
<button class="button" onclick="claimReward(100)">Claim 1 TON (Requires 100 points)</button>
<button class="button" onclick="claimReward(500)">Claim 5 TON (Requires 500 points)</button>
<button class="button" onclick="claimReward(1000)">Claim 10 TON (Requires 1000 points)</button>
<button class="button" onclick="showHome()">Back to Home</button>
</div>

<div id="invite" style="display: none;">
<h2>Invite Friends</h2>
<p>Your invite link:</p>
<input type="text" id="inviteLink" readonly value="https://t.me/YourBotUsername?start=ref123456">
<button class="button" onclick="copyInviteLink()">Copy Link</button>
<button class="button" onclick="showHome()">Back to Home</button>
</div>

<div id="stats" style="display: none;">
<h2>Stats & Progress</h2>
<h3>Daily Goal Progress</h3>
<div class="progress-bar">
<span class="progress-bar-fill" style="width:0%;">
<span class="progress-bar-text">0%</span>
</span>
</div>
<h3>Weekly Stats</h3>
<div id="weeklyStats"></div>
<button class="button" onclick="showHome()">Back to Home</button>
</div>

<div id="levelUp" style="display: none;">
<h2>Level Up</h2>
<p>Current Level: <span id="currentLevel">0</span></p>
<p>TNT Required: <span id="tntRequired">0</span></p>
<p>GMT Required: <span id="gmtRequired">0</span></p>
<button class="button" onclick="performLevelUp()">Perform Level Up</button>
<button class="button" onclick="showHome()">Back to Home</button>
</div>

<div id="shop" style="display: none;">
<h2>Shop</h2>
<button class="button" onclick="buyItem('Sneaker Box')">Buy Sneaker Box (300 GST)</button>
<button class="button" onclick="buyItem('Gem')">Buy Gem (100 GST)</button>
<button class="button" onclick="showHome()">Back to Home</button>
</div>
</div>

<script>
let webApp = window.Telegram.WebApp;
webApp.ready();

let gst = 0;
let energy = 10;
let level = 0;
let sneakerType = 'Walker';
let watchId;
let map;
let marker;
let startTime;
let distance = 0;
let lastPosition;
let score = 0;

const sneakerTypes = {
Walker: { optimalSpeed: { min: 1, max: 6 }, gstReturn: 4 },
Jogger: { optimalSpeed: { min: 4, max: 10 }, gstReturn: 5 },
Runner: { optimalSpeed: { min: 8, max: 20 }, gstReturn: 6 },
Trainer: { optimalSpeed: { min: 1, max: 20 }, gstReturn: 5.5 }
};

function initMap() {
map = L.map('map').setView([0, 0], 2);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
attribution: '© OpenStreetMap contributors'
}).addTo(map);
}

function selectSneakerType(type) {
sneakerType = type;
document.querySelectorAll('.sneaker-type').forEach(el => el.classList.remove('active'));
document.querySelector(`.sneaker-type:contains('${type}')`).classList.add('active');
webApp.showAlert(`You selected ${type} sneaker`);
}

function startTracking() {
if (energy <= 0) {
webApp.showAlert("You don't have enough energy to start tracking");
return;
}

if ("geolocation" in navigator) {
startTime = new Date();
watchId = navigator.geolocation.watchPosition((position) => {
updateLocation(position);
updateStats();
}, (error) => {
console.error("Error getting location: " + error.message);
webApp.showAlert("Error getting location: " + error.message);
}, {
enableHighAccuracy: true
});
} else {
console.error("Geolocation is not supported by this browser.");
webApp.showAlert("Geolocation is not supported by this browser.");
}
}

function stopTracking() {
if (watchId) {
navigator.geolocation.clearWatch(watchId);
calculateRewards();
webApp.showAlert("Tracking stopped");
}
}

function updateLocation(position) {
const lat = position.coords.latitude;
const lon = position.coords.longitude;

if (!marker) {
marker = L.marker([lat, lon]).addTo(map);
} else {
marker.setLatLng([lat, lon]);
}

map.setView([lat, lon], 13);

if (lastPosition) {
distance += calculateDistance(lastPosition, position.coords);
}
lastPosition = position.coords;

updateProgressBar();
}

function calculateDistance(pos1, pos2) {
const R = 6371e3; // Earth's radius in meters
const φ1 = pos1.latitude * Math.PI/180;
const φ2 = pos2.latitude * Math.PI/180;
const Δφ = (pos2.latitude - pos1.latitude) * Math.PI/180;
const Δλ = (pos2.longitude - pos1.longitude) * Math.PI/180;

const a = Math.sin(Δφ/2) * Math.sin(Δφ/2) +
Math.cos(φ1) * Math.cos(φ2) *
Math.sin(Δλ/2) * Math.sin(Δλ/2);
const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));

return R * c;
}

function updateStats() {
const duration = (new Date() - startTime) / 1000 / 60; // duration in minutes
const speed = distance / duration / 1000 * 60; // speed in km/h

const optimalSpeed = sneakerTypes[sneakerType].optimalSpeed;
const isOptimalSpeed = speed >= optimalSpeed.min && speed <= optimalSpeed.max;

if (isOptimalSpeed) {
gst += sneakerTypes[sneakerType].gstReturn * (duration / 60);
score += Math.floor(sneakerTypes[sneakerType].gstReturn * (duration / 60));
}

energy -= duration / 60;
if (energy < 0) energy = 0;

document.getElementById('gst').textContent = gst.toFixed(2);
document.getElementById('energy').textContent = energy.toFixed(2);
document.getElementById('level').textContent = level;
document.getElementById('rewardScore').textContent = score;
}

function updateProgressBar() {
const progressPercentage = Math.min((distance / 1000) * 10, 100); // 10km as 100%
document.querySelector('.progress-bar-fill').style.width = progressPercentage + '%';
document.querySelector('.progress-bar-text').textContent = Math.round(progressPercentage) + '%';
}

function calculateRewards() {
const earnedGST = Math.floor(gst);
gst += earnedGST;
score += earnedGST;
webApp.showAlert(`You earned ${earnedGST} GST for this tracking session!`);
}

function showHome() {
document.getElementById('home').style.display = 'block';
document.getElementById('challenges').style.display = 'none';
document.getElementById('rewards').style.display = 'none';
document.getElementById('invite').style.display = 'none';
document.getElementById('stats').style.display = 'none';
document.getElementById('levelUp').style.display = 'none';
document.getElementById('shop').style.display = 'none';
}

function showChallenges() {
document.getElementById('home').style.display = 'none';
document.getElementById('challenges').style.display = 'block';
}

function showRewards() {
document.getElementById('home').style.display = 'none';
document.getElementById('rewards').style.display = 'block';
document.getElementById('rewardScore').textContent = score;
}

function showInvite() {
document.getElementById('home').style.display = 'none';
document.getElementById('invite').style.display = 'block';
}

function showStats() {
document.getElementById('home').style.display = 'none';
document.getElementById('stats').style.display
